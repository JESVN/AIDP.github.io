<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity Web Player | AIDigitalPartners</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <style>
        /* 新增响应式样式 */
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            /* 防止滚动条出现 */
        }

        #unity-container {
            position: fixed;
            width: 100vw !important;
            height: 100vh !important;
            background: #000;
        }

        #unity-canvas {
            width: 100% !important;
            height: 100% !important;
            object-fit: contain;
            /* 保持宽高比 */
        }

        /* 移动端优化 */
        .unity-mobile #unity-canvas {
            touch-action: none;
            /* 禁用浏览器默认触控行为 */
        }
    </style>
</head>

<body>
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" tabindex="-1"></canvas>
        <!-- 保持原有DOM结构不变 -->
    </div>
    <script>
        var canvas = document.querySelector("#unity-canvas");
        var unityInstance = null;

        // 动态分辨率适配
        function adjustCanvasSize() {
            const container = document.getElementById('unity-container');
            const targetWidth = container.clientWidth;
            const targetHeight = container.clientHeight;

            // 保持游戏原始宽高比
            const gameAspect = 960 / 600;
            const windowAspect = targetWidth / targetHeight;

            if (windowAspect > gameAspect) {
                canvas.style.width = `${targetHeight * gameAspect}px`;
                canvas.style.height = `${targetHeight}px`;
            } else {
                canvas.style.width = `${targetWidth}px`;
                canvas.style.height = `${targetWidth / gameAspect}px`;
            }

            // 通知Unity调整渲染分辨率
            if (unityInstance) {
                unityInstance.SetFullscreen(0); // 临时退出全屏
                unityInstance.Module.canvas.style.width = canvas.style.width;
                unityInstance.Module.canvas.style.height = canvas.style.height;
            }
        }

        // 窗口大小变化监听
        window.addEventListener('resize', () => {
            adjustCanvasSize();
            // 防抖处理
            clearTimeout(window.resizeTimer);
            window.resizeTimer = setTimeout(adjustCanvasSize, 200);
        });

        // 全屏切换处理
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        var config = {
            // ...保持原有配置不变...
            devicePixelRatio: window.devicePixelRatio || 1, // 高DPI设备支持
        };

        // 移动设备适配增强
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            // 禁用双击缩放
            document.addEventListener('dblclick', e => {
                e.preventDefault();
            }, { passive: false });

            // 虚拟控制台提示
            const mobileTips = document.createElement('div');
            mobileTips.style = 'position:fixed; bottom:20px; color:#fff; text-align:center; width:100%;';
            mobileTips.innerHTML = '双指缩放可调整视角';
            document.body.appendChild(mobileTips);
        }

        // Unity加载完成回调
        createUnityInstance(canvas, config, (progress) => {
            /* 加载进度处理 */
        }).then((instance) => {
            unityInstance = instance;
            adjustCanvasSize(); // 初始尺寸调整

            // 全屏按钮自定义处理
            document.querySelector("#unity-fullscreen-button").onclick = () => {
                toggleFullscreen();
                setTimeout(adjustCanvasSize, 300); // 全屏切换后重排
            };

            // 监听全屏状态变化
            document.addEventListener('fullscreenchange', adjustCanvasSize);
        });

        // 首次加载后立即调整
        window.addEventListener('load', adjustCanvasSize);
    </script>
</body>

</html>
